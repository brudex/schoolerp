(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{OKci:function(e,i,t){"use strict";t.r(i);var n=t("zWga"),s=t.n(n),a=(t("b9ZE"),{components:{RTCMultiConnection:s.a},data:function(){return{uuid:this.$route.params.uuid,meeting:{},attachments:[],roomId:"",is_joined:!1,is_duplicate:!1,can_share_screen:!1,is_screen_shared:!1,screen_share_stream:{},socketURL:null,enableAudio:!0,enableVideo:!0,enableLogs:!1,autoplay:!0,cameraHeight:160,rtcmConnection:null,localVideo:null,screen_width:window.innerWidth,videoList:[],canvas:null,is_owner:!1,scrollOptions:{vuescroll:{mode:"native"},bar:{background:"#171A23"}}}},mounted:function(){helper.hasPermission("list-meeting")||(helper.notAccessibleMsg(),this.$router.push("/dashboard")),window.IsDuplicate()&&(this.is_duplicate=!0),this.getMeeting()},beforeRouteLeave:function(e,i,t){this.is_joined&&this.leave(),t()},methods:{getMeeting:function(){var e=this,i=this.$loading.show();axios.get("/api/meeting/"+this.uuid+"?live=true").then((function(t){e.meeting=t.meeting,e.attachments=t.attachments,e.socketURL=t.socket,e.meeting.user_id===helper.getAuthUser("id")&&(e.is_owner=!0);var n=e;e.rtcmConnection=new s.a,e.rtcmConnection.socketURL=e.socketURL,e.rtcmConnection.autoCreateMediaElement=!1,e.rtcmConnection.enableLogs=e.enableLogs,e.rtcmConnection.session={audio:e.enableAudio,video:e.enableVideo},e.rtcmConnection.iceServers=t.ice_servers||[],e.rtcmConnection.sdpConstraints.mandatory={OfferToReceiveAudio:e.enableAudio,OfferToReceiveVideo:e.enableVideo},e.rtcmConnection.onstream=function(e){if(void 0===n.videoList.find((function(i){return i.id===e.streamid}))){var i=!1;e.hasOwnProperty("stream")&&!1===e.stream.isVideo&&!1===e.stream.isAudio&&(i=!0);var t={id:e.streamid,muted:"local"===e.type,fullName:e.extra.fullName,userUuid:e.extra.userUuid,screenSharing:i,isOwner:e.extra.isOwner,maximized:0===n.videoList.length?-1:e.extra.maximized},s=n.videoList.findIndex((function(e){return e.userUuid===t.userUuid&&e.screenSharing===t.screenSharing}));s>=0&&n.videoList.splice(s,1),t.screenSharing&&t.userUuid===helper.getAuthUser("uuid")||(n.meeting.audience_video_preference?(n.is_owner||!n.is_owner&&(t.isOwner||t.userUuid===helper.getAuthUser("uuid")))&&n.videoList.push(t):n.videoList.push(t)),"local"===e.type&&(t.maximized=-1,n.localVideo=t)}setTimeout((function(){if(n.$refs.hasOwnProperty("videos"))for(var i=0,t=n.$refs.videos.length;i<t;i++)if(n.$refs.videos[i].id===e.streamid){n.$refs.videos[i].srcObject=e.stream;break}}),1e3)},e.rtcmConnection.onstreamended=function(e){n.videoList=n.videoList.filter((function(i){return i.id!=e.streamid}))},i.hide()})).catch((function(t){i.hide(),helper.showErrorMsg(t),e.$router.push("/communication/meeting")}))},highlight:function(e){this.videoList.forEach((function(i){i.maximized=i.id===e.id?-1:0}))},join:function(){var e=this,i=this.$loading.show();axios.post("/api/meeting/"+this.uuid+"/join").then((function(t){if(e.roomId=t.code,!e.roomId)return toastr.error(i18n.general.something_wrong),void i.hide();var n=e;e.rtcmConnection.extra={fullName:helper.getAuthUser("name"),userUuid:helper.getAuthUser("uuid"),isOwner:!!e.is_owner,maximized:0},e.rtcmConnection.openOrJoin(e.roomId,(function(e,i){!1===e&&n.rtcmConnection.isInitiator,n.is_joined=!0,n.meeting.user_id==helper.getAuthUser("id")&&(n.can_share_screen=!0)})),i.hide()})).catch((function(e){i.hide(),helper.showErrorMsg(e)}))},leave:function(){var e=this,i=this.$loading.show();axios.post("/api/meeting/"+this.uuid+"/leave").then((function(t){e.is_joined&&(e.rtcmConnection.attachStreams.forEach((function(e){e.stop()})),e.videoList=[],e.is_joined=!1),i.hide()})).catch((function(e){i.hide(),helper.showErrorMsg(e)}))},share:function(){var e=this;if(navigator.getDisplayMedia||navigator.mediaDevices.getDisplayMedia){var i=function(i){i.screenSharing=!0,e.rtcmConnection.addStream(i),e.screen_share_stream=i,e.is_screen_shared=!0,function(e,i){var t="ended";"oninactive"in e&&(t="inactive"),e.addEventListener(t,(function(){i(),i=function(){}}),!1)}(i,(function(){e.rtcmConnection.removeStream(i.streamid),e.is_screen_shared=!1}))},t=function(e){console.log("Media error: "+JSON.stringify(e))};navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1}).then((function(e){i(e)}),t).catch(t):navigator.getDisplayMedia&&navigator.getDisplayMedia({video:!0}).then((function(e){i(e)}),t).catch(t)}},logEvent:function(e){},formatDate:function(e){return helper.formatDate(e)},formatTime:function(e){return helper.formatTime(e)},fullScreen:function(e){var i=document.getElementById(e.id);i.requestFullscreen?i.requestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.msRequestFullscreen&&i.msRequestFullscreen()}},filters:{moment:function(e){return helper.formatDate(e)},momentDateTime:function(e){return helper.formatDateTime(e)},momentTime:function(e){return helper.formatTime(e)}},computed:{authToken:function(){return helper.getAuthToken()},isDemo:function(){return!helper.getConfig("mode")},maximizeVideoHeight:function(){return this.screen_width<400?180:this.screen_width<640?220:this.screen_width<=768?360:400},minimizeVideoHeight:function(){return this.screen_width<400?180:this.screen_width<640?220:this.screen_width<=768?360:220},orderedVideoList:function(){var e=this.videoList;return e.sort((function(e,i){var t=new Date(e.maximized),n=new Date(i.maximized);return t<n?-1:t>n?1:0})),e}}}),o=(t("uqDO"),t("KHd+")),r=Object(o.a)(a,(function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticStyle:{width:"100vw","min-height":"100vh",background:"#000000",padding:"20px"}},[e.is_duplicate?t("div",[t("p",[e._v("\n              "+e._s(e.trans("communication.duplicate_tab"))+"\n          ")])]):t("div",[t("vue-scroll",{attrs:{ops:e.scrollOptions}},[t("div",{staticStyle:{padding:"10px 20px",background:"#171A23"}},[t("div",{staticClass:"d-flex"},[t("p",{staticClass:"mr-auto p-1",staticStyle:{color:"#AEB5C0",padding:"0",margin:"0"}},[e._v("\n                          "+e._s(e.meeting.title)+"\n                          "),e.meeting.is_live?t("span",{staticClass:"ml-2 label label-success"},[e._v(e._s(e.trans("communication.live")))]):e._e(),e._v(" "),e.meeting.is_expired?t("span",{staticClass:"ml-2 label label-danger"},[e._v(e._s(e.trans("communication.expired")))]):e._e()]),e._v(" "),t("div",{staticClass:"p-1"}),e._v(" "),t("div",{staticClass:"p-1"},[t("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.trans("communication.back_to_meeting"),expression:"trans('communication.back_to_meeting')"}],staticClass:"icon custom-button",on:{click:function(i){return e.$router.push("/communication/meeting/"+e.meeting.uuid)}}},[t("i",{staticClass:"fa fa-arrow-circle-left"})])])])]),e._v(" "),t("div",{staticClass:"container-fluid"},[e.meeting.is_live?t("div",{staticClass:"row mt-3"},[e.is_joined?e._e():t("div",{staticClass:"col"},[t("button",{staticClass:"btn btn-block btn-success",on:{click:e.join}},[e._v(e._s(e.trans("communication.join_meeting")))])]),e._v(" "),e.is_joined&&e.can_share_screen?t("div",{staticClass:"col"},[e.is_screen_shared?e._e():t("button",{staticClass:"btn btn-block btn-info",on:{click:e.share}},[e._v(e._s(e.trans("communication.share_screen")))]),e._v(" "),e.is_screen_shared?t("button",{staticClass:"btn btn-block btn-info",attrs:{disabled:""}},[e._v(e._s(e.trans("communication.stop_share_screen")))]):e._e()]):e._e(),e._v(" "),e.is_joined?t("div",{staticClass:"col"},[t("button",{staticClass:"btn btn-block btn-danger",on:{click:e.leave}},[e._v(e._s(e.trans("communication.leave_meeting")))])]):e._e()]):e._e(),e._v(" "),t("div",{staticStyle:{display:"flex",height:"auto","flex-wrap":"wrap","justify-content":"flex-start","margin-top":"10px"}},[t("div",{staticClass:"video-item mr-1",staticStyle:{flex:"1 0 49.5%"}},[t("vue-scroll",{attrs:{ops:e.scrollOptions}},[t("p",[e._v(e._s(e.trans("communication.meeting_start_time"))+": "+e._s(e._f("moment")(e.meeting.date))+" "+e._s(e._f("momentTime")(e.meeting.start_time)))]),e._v(" "),t("p",[e._v(e._s(e.trans("communication.meeting_end_time"))+": "+e._s(e._f("moment")(e.meeting.date))+" "+e._s(e._f("momentTime")(e.meeting.end_time)))]),e._v(" "),e.attachments.length?t("div",[t("ul",{staticClass:"m-t-10 upload-file-list"},e._l(e.attachments,(function(i){return t("li",{key:i.uuid,staticClass:"upload-file-list-item"},[t("a",{staticClass:"no-link-color",attrs:{href:"/communication/meeting/"+e.meeting.uuid+"/attachment/"+i.uuid+"/download?token="+e.authToken}},[t("i",{class:["file-icon","fas","fa-lg",i.file_info.icon]}),e._v(" "),t("span",{staticClass:"upload-file-list-item-size"},[e._v(e._s(i.file_info.size))]),e._v(" "+e._s(i.user_filename))])])})),0)]):e._e(),e._v(" "),t("div",{domProps:{innerHTML:e._s(e.meeting.description)}})])],1),e._v(" "),e.meeting.is_live||e.meeting.is_expired?e._e():[t("div",{staticClass:"video-item",staticStyle:{flex:"1 0 49.5%"}},[t("p",{staticClass:"text-center"},[e._v(e._s(e.trans("communication.meeting_scheduled",{date:e.formatDate(e.meeting.date),time:e.formatTime(e.meeting.start_time)})))])])],e._v(" "),e.meeting.is_expired?[t("div",{staticClass:"video-item",staticStyle:{flex:"1 0 49.5%"}},[t("p",{staticClass:"text-center"},[e._v(e._s(e.trans("communication.meeting_ended",{date:e.formatDate(e.meeting.date),time:e.formatTime(e.meeting.end_time)})))])])]:e._e(),e._v(" "),e.meeting.is_live?[e.is_joined?e._e():t("div",{staticClass:"video-item",staticStyle:{flex:"1 0 49.5%"}},[t("p",{staticClass:"text-center"},[e._v(e._s(e.trans("communication.join_meeting_instruction")))])]),e._v(" "),e.is_joined?e._l(e.orderedVideoList,(function(i,n){return t("div",{key:i.id,class:["video-item",0===n||e.screen_width<=768?"video-maximized":"video-minimized",i.maximized?"maxmized":""]},[t("video",{ref:"videos",refInFor:!0,attrs:{autoplay:"",height:0===n?e.maximizeVideoHeight:e.minimizeVideoHeight,playsinline:"",id:i.id},domProps:{muted:i.muted}}),e._v(" "),t("p",{staticClass:"mt-3"},[e._v("\n                                      "+e._s(i.fullName)+" "),i.screenSharing?t("span",[e._v(e._s(e.trans("communication.screen")))]):e._e(),e._v(" "),-1!=i.maximized?t("span",{staticClass:"ml-2 custom-button",on:{click:function(t){return e.highlight(i)}}},[t("i",{staticClass:"fas fa-expand-arrows-alt"})]):e._e(),e._v(" "),0===n?t("span",{staticClass:"ml-2 custom-button",on:{click:function(t){return e.fullScreen(i)}}},[t("i",{staticClass:"fas fa-expand"})]):e._e()])])})):e._e()]:e._e()],2)])])],1)])}),[],!1,null,"6ee276c6",null);i.default=r.exports},PB0e:function(e,i,t){(e.exports=t("I1BE")(!1)).push([e.i,"\n.icon[data-v-6ee276c6] {\n    margin-right: 10px;\n}\n@media (max-width: 991px) {\n.col-t-m[data-v-6ee276c6] {\n        margin: 4px 0;\n}\n}\n.video-item[data-v-6ee276c6] {\n    display: flex; \n    flex-direction: column; \n    align-items: center; \n    justify-content: space-around; \n    align-self: stretch;\n    background: #171A23; \n    padding: 10px 20px;\n    margin-top: 0.25rem !important;\n    margin-right: 0.25rem !important;\n}\n.video-maximized[data-v-6ee276c6] {\n    flex: 1 0 49.5%;\n}\n.video-minimized[data-v-6ee276c6] {\n    padding-top: 20px;\n    flex: 0 0 19.7%;\n}\n.maximized[data-v-6ee276c6] {\n    order: -1;\n}\n",""])},ROEc:function(e,i,t){var n=t("PB0e");"string"==typeof n&&(n=[[e.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};t("aET+")(n,s);n.locals&&(e.exports=n.locals)},uqDO:function(e,i,t){"use strict";var n=t("ROEc");t.n(n).a}}]);
//# sourceMappingURL=live.js.map?id=a4758fce02ccc4e8630d